<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vegas Baby! March 6-8, 2026</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Oswald:wght@400;500;600;700&family=Source+Sans+Pro:wght@400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --red-primary: #D32F2F;
            --red-dark: #C62828;
            --gold-primary: #FFD700;
            --gold-dark: #FFC107;
            --neon-pink: #FF1493;
            --electric-blue: #00CED1;
            --turquoise: #40E0D0;
            --bg-dark: #1a1a2e;
            --bg-darker: #0f0f1e;
            --cream: #FFF8DC;
            --cream-light: #FFFACD;
            --felt-green: #0d5c2e;
            --purple: #9C27B0;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: var(--bg-darker);
            color: var(--cream);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Neon Text Effect */
        .neon-text {
            text-shadow:
                0 0 5px var(--gold-primary),
                0 0 10px var(--gold-primary),
                0 0 20px var(--gold-dark),
                0 0 40px var(--gold-dark);
        }

        .neon-red {
            text-shadow:
                0 0 5px var(--red-primary),
                0 0 10px var(--red-primary),
                0 0 20px var(--red-dark),
                0 0 40px var(--red-dark);
        }

        .neon-pink {
            text-shadow:
                0 0 5px var(--neon-pink),
                0 0 10px var(--neon-pink),
                0 0 20px var(--neon-pink);
        }

        /* Header */
        header {
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            padding: 15px 20px;
            text-align: center;
            border-bottom: 3px solid var(--gold-primary);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '‚ô† ‚ô• ‚ô¶ ‚ô£';
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 12px;
            color: var(--gold-dark);
            opacity: 0.5;
            letter-spacing: 5px;
        }

        header::after {
            content: '‚ô£ ‚ô¶ ‚ô• ‚ô†';
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 12px;
            color: var(--gold-dark);
            opacity: 0.5;
            letter-spacing: 5px;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 900;
            color: var(--gold-primary);
            letter-spacing: 3px;
            animation: neonFlicker 3s infinite;
        }

        @keyframes neonFlicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                text-shadow:
                    0 0 5px var(--gold-primary),
                    0 0 10px var(--gold-primary),
                    0 0 20px var(--gold-dark),
                    0 0 40px var(--gold-dark);
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }

        .trip-dates {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            color: var(--neon-pink);
            letter-spacing: 2px;
            margin-top: 5px;
        }

        /* Navigation */
        nav {
            background: linear-gradient(180deg, #2a2a3e 0%, var(--bg-dark) 100%);
            padding: 10px;
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid var(--red-primary);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--cream);
            font-family: 'Oswald', sans-serif;
            font-size: 0.75rem;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-btn .icon {
            font-size: 1.3rem;
        }

        .nav-btn.active {
            color: var(--gold-primary);
            text-shadow: 0 0 10px var(--gold-primary);
        }

        .nav-btn:hover {
            color: var(--gold-primary);
            transform: scale(1.05);
        }

        /* Main Content */
        main {
            padding: 15px;
            padding-bottom: 80px;
            max-width: 800px;
            margin: 0 auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: linear-gradient(145deg, #252538 0%, #1e1e30 100%);
            border: 1px solid var(--gold-dark);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--red-primary), var(--gold-primary), var(--red-primary));
        }

        .card-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            color: var(--gold-primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Buttons */
        .btn {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(180deg, var(--red-primary) 0%, var(--red-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(211, 47, 47, 0.6);
        }

        .btn-gold {
            background: linear-gradient(180deg, var(--gold-primary) 0%, var(--gold-dark) 100%);
            color: var(--bg-darker);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gold-primary);
            color: var(--gold-primary);
        }

        .btn-outline:hover {
            background: var(--gold-primary);
            color: var(--bg-darker);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            color: var(--gold-primary);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,215,0,0.3);
            border-radius: 8px;
            color: var(--cream);
            font-family: 'Source Sans Pro', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 10px rgba(255,215,0,0.3);
        }

        .form-control::placeholder {
            color: rgba(255,248,220,0.4);
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23FFD700' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }

        select.form-control option {
            background: white;
            color: #000;
        }

        select.form-control:focus option:checked {
            background: #d4af37;
            color: #000;
        }

        /* Checkbox & Radio styling */
        .checkbox-group, .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .checkbox-item:hover, .radio-item:hover {
            background: rgba(255,215,0,0.1);
        }

        .checkbox-item.selected, .radio-item.selected {
            background: rgba(255,215,0,0.2);
            border: 1px solid var(--gold-primary);
        }

        /* Stats Display */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-box {
            background: linear-gradient(145deg, #1a3a1a 0%, #0d2d0d 100%);
            border: 1px solid var(--gold-dark);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            color: var(--gold-primary);
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--cream);
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        /* Expense Item */
        .expense-item {
            background: rgba(255,255,255,0.03);
            border-left: 3px solid var(--gold-primary);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 0 8px 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expense-info {
            flex: 1;
        }

        .expense-desc {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .expense-meta {
            font-size: 0.8rem;
            color: rgba(255,248,220,0.6);
        }

        .expense-amount {
            font-family: 'Oswald', sans-serif;
            font-size: 1.2rem;
            color: var(--gold-primary);
        }

        /* Category Pills */
        .category-pill {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 5px;
        }

        .cat-food { background: #FF9800; color: #000; }
        .cat-entertainment { background: var(--neon-pink); color: #fff; }
        .cat-transport { background: var(--electric-blue); color: #000; }
        .cat-accommodation { background: var(--purple); color: #fff; }
        .cat-nightlife { background: #E91E63; color: #fff; }
        .cat-casino { background: var(--felt-green); color: #fff; }
        .cat-shows { background: var(--red-primary); color: #fff; }
        .cat-other { background: #607D8B; color: #fff; }

        /* Attendee Badge */
        .attendee-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .attendee-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Activity Item */
        .activity-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,215,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .activity-time {
            font-family: 'Oswald', sans-serif;
            color: var(--neon-pink);
            font-size: 0.9rem;
        }

        .activity-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 5px 0;
        }

        .activity-location {
            font-size: 0.85rem;
            color: var(--electric-blue);
            cursor: pointer;
        }

        .activity-location:hover {
            text-decoration: underline;
        }

        .activity-status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 10px;
        }

        .status-confirmed {
            background: #4CAF50;
            color: white;
        }

        .status-tentative {
            background: #FF9800;
            color: black;
        }

        /* Balance Display */
        .balance-positive {
            color: #4CAF50;
        }

        .balance-negative {
            color: var(--red-primary);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-dark);
            border: 2px solid var(--gold-primary);
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(90deg, var(--red-primary), var(--red-dark));
            padding: 15px 20px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(255,215,0,0.2);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Map Container */
        #map, .map-container {
            height: 300px;
            border-radius: 10px;
            border: 2px solid var(--gold-dark);
            margin-bottom: 15px;
        }

        /* Receipt Thumbnail */
        .receipt-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--gold-dark);
            cursor: pointer;
        }

        .receipt-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Calendar View */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
        }

        .day-tab:first-child {
            border-radius: 10px 0 0 10px;
        }

        .day-tab:last-child {
            border-radius: 0 10px 10px 0;
        }

        .day-tab.active {
            background: var(--red-primary);
            color: white;
        }

        .day-tab:hover:not(.active) {
            background: rgba(255,215,0,0.1);
        }

        /* Settlement Card */
        .settlement-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .settlement-arrow {
            color: var(--gold-primary);
            font-size: 1.2rem;
        }

        /* Quick Add Chips */
        .quick-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .chip {
            padding: 8px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--gold-dark);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .chip:hover {
            background: var(--gold-primary);
            color: var(--bg-darker);
        }

        /* Event Card */
        .event-card {
            background: linear-gradient(145deg, #2a1a2a 0%, #1a1a2a 100%);
            border: 1px solid var(--neon-pink);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .event-date {
            font-family: 'Oswald', sans-serif;
            color: var(--neon-pink);
            font-size: 0.85rem;
        }

        .event-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 5px 0;
        }

        .event-venue {
            font-size: 0.85rem;
            color: rgba(255,248,220,0.7);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255,248,220,0.5);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Decorative Elements */
        .suits-decoration {
            color: var(--gold-dark);
            opacity: 0.3;
            font-size: 0.8rem;
            letter-spacing: 3px;
        }

        /* Photo Upload Area */
        .upload-area {
            border: 2px dashed var(--gold-dark);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--gold-primary);
            background: rgba(255,215,0,0.05);
        }

        .upload-area input {
            display: none;
        }

        /* Jackpot Counter Style */
        .jackpot-display {
            font-family: 'Oswald', sans-serif;
            font-size: 2rem;
            color: var(--gold-primary);
            text-align: center;
            padding: 15px;
            background: linear-gradient(180deg, #1a1a1a 0%, #0a0a0a 100%);
            border: 3px solid var(--gold-dark);
            border-radius: 10px;
            text-shadow: 0 0 10px var(--gold-primary);
            letter-spacing: 2px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-darker);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold-dark);
            border-radius: 4px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--felt-green);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-family: 'Oswald', sans-serif;
            z-index: 2000;
            animation: slideUp 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive adjustments */
        @media (max-width: 400px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .nav-btn {
                font-size: 0.65rem;
                padding: 6px 8px;
            }

            .nav-btn .icon {
                font-size: 1.1rem;
            }
        }

        /* Delete button */
        .btn-delete {
            background: transparent;
            border: none;
            color: var(--red-primary);
            cursor: pointer;
            padding: 5px;
            font-size: 1rem;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .btn-delete:hover {
            opacity: 1;
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .image-modal.active {
            display: flex;
        }

        .image-modal img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 10px;
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }

        /* Flex utilities */
        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mt-10 { margin-top: 10px; }
        .mb-10 { margin-bottom: 10px; }
        .mb-15 { margin-bottom: 15px; }
        .mb-20 { margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">‚ô† VEGAS BABY! ‚ô†</div>
        <div class="trip-dates">March 6-8, 2026</div>
    </header>

    <!-- Navigation -->
    <nav>
        <button class="nav-btn active" data-page="dashboard">
            <span class="icon">üé∞</span>
            <span>Home</span>
        </button>
        <button class="nav-btn" data-page="expenses">
            <span class="icon">üí∞</span>
            <span>Money</span>
        </button>
        <button class="nav-btn" data-page="itinerary">
            <span class="icon">üìÖ</span>
            <span>Plans</span>
        </button>
        <button class="nav-btn" data-page="attendees">
            <span class="icon">üë•</span>
            <span>Crew</span>
        </button>
        <button class="nav-btn" data-page="map">
            <span class="icon">üó∫Ô∏è</span>
            <span>Map</span>
        </button>
    </nav>

    <!-- Main Content -->
    <main>
        <!-- Dashboard Page -->
        <div class="page active" id="dashboard">
            <div class="card">
                <div class="card-title">üé≤ Trip Overview</div>
                <div class="jackpot-display" id="total-spent">$0.00</div>
                <div style="text-align: center; margin-top: 5px; font-size: 0.85rem; opacity: 0.7;">TOTAL TRIP SPENDING</div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="stat-expenses">0</div>
                    <div class="stat-label">Expenses</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-attendees">0</div>
                    <div class="stat-label">Crew Members</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-activities">0</div>
                    <div class="stat-label">Activities</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="stat-average">$0</div>
                    <div class="stat-label">Per Person</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">‚ö° Quick Actions</div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button class="btn btn-primary btn-sm" onclick="openModal('expense')">+ Add Expense</button>
                    <button class="btn btn-gold btn-sm" onclick="openModal('activity')">+ Add Activity</button>
                    <button class="btn btn-outline btn-sm" onclick="openModal('attendee')">+ Add Person</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üìç Upcoming Activities</div>
                <div id="upcoming-activities">
                    <div class="empty-state">
                        <div class="icon">üé≠</div>
                        <p>No activities planned yet.<br>Start adding to your itinerary!</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üí∏ Outstanding Balances</div>
                <div id="dashboard-balances">
                    <div class="empty-state">
                        <div class="icon">‚ú®</div>
                        <p>All squared up!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expenses Page -->
        <div class="page" id="expenses">
            <div class="flex-between mb-15">
                <h2 style="font-family: 'Oswald', sans-serif; color: var(--gold-primary);">üí∞ EXPENSES</h2>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-gold btn-sm" onclick="openModal('reimbursement')">üí∏ Reimburse</button>
                    <button class="btn btn-primary btn-sm" onclick="openModal('expense')">+ Add</button>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üìä Summary</div>
                <div id="expense-summary"></div>
            </div>

            <div class="card">
                <div class="card-title">üßæ All Expenses</div>
                <div id="expense-list">
                    <div class="empty-state">
                        <div class="icon">üíµ</div>
                        <p>No expenses yet.<br>Add your first expense!</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üí∏ Reimbursements</div>
                <div id="reimbursement-list">
                    <div class="empty-state">
                        <p>No reimbursements recorded yet</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ü§ù Settlement Suggestions</div>
                <div id="settlements">
                    <div class="empty-state">
                        <p>Add expenses to see who owes whom</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üñºÔ∏è Receipt Gallery</div>
                <div class="receipt-gallery" id="receipt-gallery">
                    <div class="empty-state" style="width: 100%;">
                        <p>No receipts uploaded yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Itinerary Page -->
        <div class="page" id="itinerary">
            <div class="flex-between mb-15">
                <h2 style="font-family: 'Oswald', sans-serif; color: var(--gold-primary);">üìÖ ITINERARY</h2>
                <button class="btn btn-gold btn-sm" onclick="openModal('activity')">+ Add</button>
            </div>

            <div class="calendar-header">
                <div class="day-tab active" data-date="2026-03-06">Fri 6th</div>
                <div class="day-tab" data-date="2026-03-07">Sat 7th</div>
                <div class="day-tab" data-date="2026-03-08">Sun 8th</div>
            </div>

            <div class="quick-chips">
                <div class="chip" onclick="filterActivities('all')">üé≤ All</div>
                <div class="chip" onclick="filterActivities('food')">üçî Food</div>
                <div class="chip" onclick="filterActivities('casino')">üé∞ Casino</div>
                <div class="chip" onclick="filterActivities('shows')">üé≠ Shows</div>
                <div class="chip" onclick="filterActivities('nightlife')">üç∏ Nightlife</div>
                <div class="chip" onclick="filterActivities('stripclub')">üíÉ Clubs</div>
            </div>

            <div id="activity-list">
                <div class="empty-state">
                    <div class="icon">üóìÔ∏è</div>
                    <p>No activities for this day.<br>Time to plan some fun!</p>
                </div>
            </div>

            <div class="card mt-10">
                <div class="card-title">üî• Vegas Events (Mar 6-8)</div>
                <div id="vegas-events">
                    <!-- UFC FIGHT - HEADLINE EVENT -->
                    <div class="event-card" style="border: 2px solid var(--red-primary); background: linear-gradient(145deg, #3a1a1a 0%, #2a1a1a 100%);">
                        <div class="event-date" style="color: var(--red-primary);">ü•ä Saturday, March 7, 2026 ‚Ä¢ 7PM PT</div>
                        <div class="event-title" style="font-size: 1.3rem; color: var(--gold-primary);">UFC Fight Night</div>
                        <div class="event-venue">T-Mobile Arena</div>
                        <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.8;">Main Card + Prelims ‚Ä¢ Premium Seating Available</div>
                        <button class="btn btn-sm btn-primary mt-10" onclick="addEventToItinerary('UFC Fight Night', 'T-Mobile Arena', 'entertainment')">+ Add to Plans</button>
                    </div>

                    <!-- SHOWS -->
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Nightly 7PM & 9:30PM</div>
                        <div class="event-title">Cirque du Soleil - "O"</div>
                        <div class="event-venue">Bellagio Hotel & Casino</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Cirque du Soleil - O', 'Bellagio Hotel & Casino', 'shows')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Nightly 7PM & 9:30PM</div>
                        <div class="event-title">Blue Man Group</div>
                        <div class="event-venue">Luxor Hotel & Casino</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Blue Man Group', 'Luxor Hotel & Casino', 'shows')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ 8PM</div>
                        <div class="event-title">Absinthe</div>
                        <div class="event-venue">Caesars Palace (Spiegeltent)</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Absinthe', 'Caesars Palace', 'shows')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ 9PM</div>
                        <div class="event-title">Magic Mike Live</div>
                        <div class="event-venue">Sahara Las Vegas</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Magic Mike Live', 'Sahara Las Vegas', 'shows')">+ Add to Plans</button>
                    </div>

                    <!-- NIGHTLIFE -->
                    <div class="event-card">
                        <div class="event-date">Saturday, March 7, 2026 ‚Ä¢ 10:30PM</div>
                        <div class="event-title">DJ Set @ Hakkasan</div>
                        <div class="event-venue">MGM Grand</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('DJ Set @ Hakkasan', 'MGM Grand', 'nightlife')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">Friday, March 6, 2026 ‚Ä¢ 10PM</div>
                        <div class="event-title">XS Nightclub</div>
                        <div class="event-venue">Wynn Las Vegas</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('XS Nightclub', 'Wynn Las Vegas', 'nightlife')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-7, 2026 ‚Ä¢ 10PM</div>
                        <div class="event-title">Omnia Nightclub</div>
                        <div class="event-venue">Caesars Palace</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Omnia Nightclub', 'Caesars Palace', 'nightlife')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">Saturday, March 7, 2026 ‚Ä¢ 11PM</div>
                        <div class="event-title">Marquee Nightclub</div>
                        <div class="event-venue">The Cosmopolitan</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Marquee Nightclub', 'The Cosmopolitan', 'nightlife')">+ Add to Plans</button>
                    </div>

                    <!-- DINING & EXPERIENCES -->
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Reservations Required</div>
                        <div class="event-title">Hell's Kitchen Restaurant</div>
                        <div class="event-venue">Caesars Palace</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Hell\\'s Kitchen Restaurant', 'Caesars Palace', 'food')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Reservations Recommended</div>
                        <div class="event-title">STK Steakhouse</div>
                        <div class="event-venue">The Cosmopolitan</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('STK Steakhouse', 'The Cosmopolitan', 'food')">+ Add to Plans</button>
                    </div>

                    <!-- ATTRACTIONS -->
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Open Daily</div>
                        <div class="event-title">High Roller Observation Wheel</div>
                        <div class="event-venue">The LINQ Promenade</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('High Roller Observation Wheel', 'The LINQ Promenade', 'attraction')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Open Daily</div>
                        <div class="event-title">Fremont Street Experience</div>
                        <div class="event-venue">Downtown Las Vegas</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Fremont Street Experience', 'Fremont Street Downtown', 'attraction')">+ Add to Plans</button>
                    </div>
                    <div class="event-card">
                        <div class="event-date">March 6-8, 2026 ‚Ä¢ Hourly Shows</div>
                        <div class="event-title">Bellagio Fountains Show</div>
                        <div class="event-venue">Bellagio Hotel & Casino</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Bellagio Fountains Show', 'Bellagio Hotel & Casino', 'attraction')">+ Add to Plans</button>
                    </div>

                    <!-- STRIP CLUBS -->
                    <div class="event-card" style="border-color: var(--purple);">
                        <div class="event-date" style="color: var(--purple);">üíÉ Open Nightly</div>
                        <div class="event-title">Sapphire Las Vegas</div>
                        <div class="event-venue">World's Largest Gentlemen's Club</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Sapphire Las Vegas', 'Sapphire Gentlemen\\'s Club', 'stripclub')">+ Add to Plans</button>
                    </div>
                    <div class="event-card" style="border-color: var(--purple);">
                        <div class="event-date" style="color: var(--purple);">üíÉ Open Nightly</div>
                        <div class="event-title">Spearmint Rhino</div>
                        <div class="event-venue">Las Vegas Strip</div>
                        <button class="btn btn-sm btn-outline mt-10" onclick="addEventToItinerary('Spearmint Rhino', 'Spearmint Rhino Las Vegas', 'stripclub')">+ Add to Plans</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendees Page -->
        <div class="page" id="attendees">
            <div class="flex-between mb-15">
                <h2 style="font-family: 'Oswald', sans-serif; color: var(--gold-primary);">üë• THE CREW</h2>
                <button class="btn btn-primary btn-sm" onclick="openModal('attendee')">+ Add</button>
            </div>

            <div id="attendee-list">
                <div class="empty-state">
                    <div class="icon">üë•</div>
                    <p>No one's on the list yet.<br>Add your Vegas crew!</p>
                </div>
            </div>
        </div>

        <!-- Map Page -->
        <div class="page" id="map">
            <h2 style="font-family: 'Oswald', sans-serif; color: var(--gold-primary); margin-bottom: 15px;">üó∫Ô∏è TRIP MAP</h2>

            <div class="quick-chips mb-15">
                <div class="chip" onclick="filterMapPins('all')">üìç All</div>
                <div class="chip" onclick="filterMapPins('food')">üçî Food</div>
                <div class="chip" onclick="filterMapPins('casino')">üé∞ Casino</div>
                <div class="chip" onclick="filterMapPins('shows')">üé≠ Shows</div>
                <div class="chip" onclick="filterMapPins('nightlife')">üç∏ Nightlife</div>
            </div>

            <div id="main-map" class="map-container" style="height: 400px;"></div>

            <div class="card mt-10">
                <div class="card-title">üìç Locations</div>
                <div id="map-locations-list">
                    <div class="empty-state">
                        <p>Add activities to see them on the map</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Expense Modal -->
    <div class="modal-overlay" id="modal-expense">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üí∞ Add Expense</span>
                <button class="modal-close" onclick="closeModal('expense')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" class="form-control" id="expense-desc" placeholder="What was it for?">
                </div>
                <div class="form-group">
                    <label>Amount ($)</label>
                    <input type="number" class="form-control" id="expense-amount" placeholder="0.00" step="0.01">
                </div>
                <div class="form-group">
                    <label>Who Paid?</label>
                    <select class="form-control" id="expense-payer">
                        <option value="">Select person...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select class="form-control" id="expense-category">
                        <option value="food">üçî Food & Drinks</option>
                        <option value="entertainment">üé≠ Entertainment</option>
                        <option value="transport">üöó Transportation</option>
                        <option value="accommodation">üè® Accommodation</option>
                        <option value="nightlife">üç∏ Nightlife</option>
                        <option value="casino">üé∞ Casino</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" id="expense-date" value="2026-03-06">
                </div>
                <div class="form-group">
                    <label>Split Between</label>
                    <div class="checkbox-group" id="expense-split-attendees">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Receipt Photo (optional)</label>
                    <div class="upload-area" onclick="document.getElementById('receipt-input').click()">
                        <input type="file" id="receipt-input" accept="image/*" capture="environment" onchange="handleReceiptUpload(event)">
                        <div>üì∑ Tap to upload or take photo</div>
                        <div id="receipt-preview" style="margin-top: 10px;"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('expense')">Cancel</button>
                <button class="btn btn-primary" onclick="saveExpense()">Save Expense</button>
            </div>
        </div>
    </div>

    <!-- Add Activity Modal -->
    <div class="modal-overlay" id="modal-activity">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üìÖ Add Activity</span>
                <button class="modal-close" onclick="closeModal('activity')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Activity Name</label>
                    <input type="text" class="form-control" id="activity-name" placeholder="What are we doing?">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <select class="form-control" id="activity-date">
                        <option value="2026-03-06">Friday, March 6</option>
                        <option value="2026-03-07">Saturday, March 7</option>
                        <option value="2026-03-08">Sunday, March 8</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" class="form-control" id="activity-time">
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" class="form-control" id="activity-location" placeholder="Where at?">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select class="form-control" id="activity-category">
                        <option value="food">üçî Food</option>
                        <option value="casino">üé∞ Casino</option>
                        <option value="shows">üé≠ Shows</option>
                        <option value="nightlife">üç∏ Nightlife</option>
                        <option value="stripclub">üíÉ Strip Club</option>
                        <option value="attraction">üé¢ Attraction</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Estimated Cost ($)</label>
                    <input type="number" class="form-control" id="activity-cost" placeholder="0.00" step="0.01">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="activity-status">
                        <option value="tentative">ü§î Tentative</option>
                        <option value="confirmed">‚úÖ Confirmed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Who's Going?</label>
                    <div class="checkbox-group" id="activity-attendees">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes / Reservation Link</label>
                    <input type="text" class="form-control" id="activity-notes" placeholder="Any details or links...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('activity')">Cancel</button>
                <button class="btn btn-gold" onclick="saveActivity()">Save Activity</button>
            </div>
        </div>
    </div>

    <!-- Add Attendee Modal -->
    <div class="modal-overlay" id="modal-attendee">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">üë§ Add Crew Member</span>
                <button class="modal-close" onclick="closeModal('attendee')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" class="form-control" id="attendee-name" placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <div class="checkbox-group" id="color-options">
                        <div class="radio-item" data-color="#FF5722" style="background: #FF5722; color: white;" onclick="selectColor('#FF5722')">Orange</div>
                        <div class="radio-item" data-color="#E91E63" style="background: #E91E63; color: white;" onclick="selectColor('#E91E63')">Pink</div>
                        <div class="radio-item" data-color="#9C27B0" style="background: #9C27B0; color: white;" onclick="selectColor('#9C27B0')">Purple</div>
                        <div class="radio-item" data-color="#2196F3" style="background: #2196F3; color: white;" onclick="selectColor('#2196F3')">Blue</div>
                        <div class="radio-item" data-color="#4CAF50" style="background: #4CAF50; color: white;" onclick="selectColor('#4CAF50')">Green</div>
                        <div class="radio-item" data-color="#FF9800" style="background: #FF9800; color: white;" onclick="selectColor('#FF9800')">Amber</div>
                    </div>
                </div>
                <div style="border-top: 1px solid rgba(255,215,0,0.2); margin: 20px 0; padding-top: 15px;">
                    <div style="font-family: 'Oswald', sans-serif; color: var(--neon-pink); margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px;">‚úàÔ∏è Travel Details</div>
                </div>
                <div class="form-group">
                    <label>Arrival Date & Time</label>
                    <input type="datetime-local" class="form-control" id="attendee-arrival" value="2026-03-06T12:00">
                </div>
                <div class="form-group">
                    <label>Arrival Flight # (optional)</label>
                    <input type="text" class="form-control" id="attendee-arrival-flight" placeholder="e.g. SW1234">
                </div>
                <div class="form-group">
                    <label>Departure Date & Time</label>
                    <input type="datetime-local" class="form-control" id="attendee-departure" value="2026-03-08T18:00">
                </div>
                <div class="form-group">
                    <label>Departure Flight # (optional)</label>
                    <input type="text" class="form-control" id="attendee-departure-flight" placeholder="e.g. SW5678">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('attendee')">Cancel</button>
                <button class="btn btn-primary" onclick="saveAttendee()">Add to Crew</button>
            </div>
        </div>
    </div>

    <!-- Reimbursement Modal -->
    <div class="modal-overlay" id="modal-reimbursement">
        <div class="modal">
            <div class="modal-header" style="background: linear-gradient(90deg, #4CAF50, #2E7D32);">
                <span class="modal-title">üí∏ Record Reimbursement</span>
                <button class="modal-close" onclick="closeModal('reimbursement')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px; opacity: 0.8; font-size: 0.9rem;">Record when someone pays back another crew member directly.</p>
                <div class="form-group">
                    <label>Who is Paying?</label>
                    <select class="form-control" id="reimburse-from">
                        <option value="">Select person...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Who are they Paying?</label>
                    <select class="form-control" id="reimburse-to">
                        <option value="">Select person...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Amount ($)</label>
                    <input type="number" class="form-control" id="reimburse-amount" placeholder="0.00" step="0.01">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" class="form-control" id="reimburse-date" value="2026-03-08">
                </div>
                <div class="form-group">
                    <label>Note (optional)</label>
                    <input type="text" class="form-control" id="reimburse-note" placeholder="e.g., Venmo, Cash, etc.">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('reimbursement')">Cancel</button>
                <button class="btn btn-gold" onclick="saveReimbursement()">Record Payment</button>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div class="image-modal" id="image-modal">
        <button class="image-modal-close" onclick="closeImageModal()">&times;</button>
        <img id="image-modal-img" src="" alt="Receipt">
    </div>

    <script>
        // ============ DATA STORAGE ============
        let tripData = {
            attendees: [],
            expenses: [],
            activities: [],
            reimbursements: []
        };

        let selectedColor = '#FF5722';
        let currentReceiptData = null;
        let selectedDate = '2026-03-06';
        let map = null;
        let markers = [];
        let editingAttendeeId = null;

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('vegasTripData');
            if (saved) {
                tripData = JSON.parse(saved);
            }
            renderAll();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('vegasTripData', JSON.stringify(tripData));
        }

        // ============ NAVIGATION ============
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.page).classList.add('active');

                if (btn.dataset.page === 'map') {
                    setTimeout(() => initMap(), 100);
                }
            });
        });

        // Day tabs
        document.querySelectorAll('.day-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                selectedDate = tab.dataset.date;
                renderActivities();
            });
        });

        // ============ MODALS ============
        function openModal(type) {
            document.getElementById(`modal-${type}`).classList.add('active');
            if (type === 'expense' || type === 'activity') {
                populateAttendeeCheckboxes(type);
            }
            if (type === 'attendee' && !editingAttendeeId) {
                // Reset modal for adding new attendee
                document.querySelector('#modal-attendee .modal-title').textContent = 'üë§ Add Crew Member';
                document.querySelector('#modal-attendee .modal-footer .btn-primary').textContent = 'Add to Crew';
            }
            if (type === 'reimbursement') {
                populateReimbursementDropdowns();
            }
        }

        function closeModal(type) {
            document.getElementById(`modal-${type}`).classList.remove('active');
            clearModalInputs(type);
            if (type === 'attendee') {
                editingAttendeeId = null;
            }
        }

        function clearModalInputs(type) {
            if (type === 'expense') {
                document.getElementById('expense-desc').value = '';
                document.getElementById('expense-amount').value = '';
                document.getElementById('expense-payer').value = '';
                document.getElementById('receipt-preview').innerHTML = '';
                currentReceiptData = null;
            } else if (type === 'activity') {
                document.getElementById('activity-name').value = '';
                document.getElementById('activity-time').value = '';
                document.getElementById('activity-location').value = '';
                document.getElementById('activity-cost').value = '';
                document.getElementById('activity-notes').value = '';
            } else if (type === 'attendee') {
                document.getElementById('attendee-name').value = '';
                document.getElementById('attendee-arrival').value = '2026-03-06T12:00';
                document.getElementById('attendee-arrival-flight').value = '';
                document.getElementById('attendee-departure').value = '2026-03-08T18:00';
                document.getElementById('attendee-departure-flight').value = '';
            } else if (type === 'reimbursement') {
                document.getElementById('reimburse-from').value = '';
                document.getElementById('reimburse-to').value = '';
                document.getElementById('reimburse-amount').value = '';
                document.getElementById('reimburse-note').value = '';
            }
        }

        // ============ ATTENDEES ============
        function selectColor(color) {
            selectedColor = color;
            document.querySelectorAll('#color-options .radio-item').forEach(item => {
                item.classList.toggle('selected', item.dataset.color === color);
            });
        }

        function editAttendee(id) {
            const attendee = tripData.attendees.find(a => a.id === id);
            if (!attendee) return;

            editingAttendeeId = id;

            // Populate modal with existing data
            document.getElementById('attendee-name').value = attendee.name;
            document.getElementById('attendee-arrival').value = attendee.arrival || '2026-03-06T12:00';
            document.getElementById('attendee-arrival-flight').value = attendee.arrivalFlight || '';
            document.getElementById('attendee-departure').value = attendee.departure || '2026-03-08T18:00';
            document.getElementById('attendee-departure-flight').value = attendee.departureFlight || '';

            // Select the correct color
            selectColor(attendee.color);

            // Update modal title and button
            document.querySelector('#modal-attendee .modal-title').textContent = '‚úèÔ∏è Edit Crew Member';
            document.querySelector('#modal-attendee .modal-footer .btn-primary').textContent = 'Save Changes';

            openModal('attendee');
        }

        function saveAttendee() {
            const name = document.getElementById('attendee-name').value.trim();
            if (!name) {
                showToast('Please enter a name');
                return;
            }

            const arrival = document.getElementById('attendee-arrival').value;
            const arrivalFlight = document.getElementById('attendee-arrival-flight').value.trim();
            const departure = document.getElementById('attendee-departure').value;
            const departureFlight = document.getElementById('attendee-departure-flight').value.trim();

            if (editingAttendeeId) {
                // Update existing attendee
                const attendee = tripData.attendees.find(a => a.id === editingAttendeeId);
                if (attendee) {
                    attendee.name = name;
                    attendee.color = selectedColor;
                    attendee.arrival = arrival;
                    attendee.arrivalFlight = arrivalFlight;
                    attendee.departure = departure;
                    attendee.departureFlight = departureFlight;
                }
                showToast(`${name} updated!`);
            } else {
                // Add new attendee
                tripData.attendees.push({
                    id: Date.now(),
                    name: name,
                    color: selectedColor,
                    arrival: arrival,
                    arrivalFlight: arrivalFlight,
                    departure: departure,
                    departureFlight: departureFlight
                });
                showToast(`${name} added to the crew!`);
            }

            editingAttendeeId = null;
            saveData();
            renderAll();
            closeModal('attendee');
        }

        function deleteAttendee(id) {
            if (confirm('Remove this person from the trip?')) {
                tripData.attendees = tripData.attendees.filter(a => a.id !== id);
                saveData();
                renderAll();
            }
        }

        function renderAttendees() {
            const container = document.getElementById('attendee-list');

            if (tripData.attendees.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üë•</div>
                        <p>No one's on the list yet.<br>Add your Vegas crew!</p>
                    </div>
                `;
                return;
            }

            const balances = calculateBalances();

            container.innerHTML = tripData.attendees.map(attendee => {
                const balance = balances[attendee.id] || 0;
                const balanceClass = balance >= 0 ? 'balance-positive' : 'balance-negative';
                const balanceText = balance >= 0 ? `Gets back $${balance.toFixed(2)}` : `Owes $${Math.abs(balance).toFixed(2)}`;
                const totalPaid = getTotalPaidBy(attendee.id);

                const arrivalDisplay = attendee.arrival ? formatDateTime(attendee.arrival) : 'Not set';
                const departureDisplay = attendee.departure ? formatDateTime(attendee.departure) : 'Not set';

                return `
                    <div class="card">
                        <div class="flex-between">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 50px; height: 50px; border-radius: 50%; background: ${attendee.color}; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold;">
                                    ${attendee.name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight: 600; font-size: 1.1rem;">${attendee.name}</div>
                                    <div style="font-size: 0.85rem; opacity: 0.7;">Paid: $${totalPaid.toFixed(2)}</div>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="${balanceClass}" style="font-family: 'Oswald', sans-serif; font-size: 1.1rem;">${balanceText}</div>
                                <button class="btn-delete" onclick="editAttendee(${attendee.id})" title="Edit">‚úèÔ∏è</button>
                                <button class="btn-delete" onclick="deleteAttendee(${attendee.id})" title="Delete">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,215,0,0.2);">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem;">
                                <div>
                                    <div style="color: var(--electric-blue); font-family: 'Oswald', sans-serif; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">‚úàÔ∏è Arriving</div>
                                    <div>${arrivalDisplay}</div>
                                    ${attendee.arrivalFlight ? `<div style="color: var(--gold-primary); font-weight: 600;">Flight: ${attendee.arrivalFlight}</div>` : ''}
                                </div>
                                <div>
                                    <div style="color: var(--neon-pink); font-family: 'Oswald', sans-serif; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px;">üõ´ Departing</div>
                                    <div>${departureDisplay}</div>
                                    ${attendee.departureFlight ? `<div style="color: var(--gold-primary); font-weight: 600;">Flight: ${attendee.departureFlight}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Update payer dropdown
            const payerSelect = document.getElementById('expense-payer');
            payerSelect.innerHTML = '<option value="">Select person...</option>' +
                tripData.attendees.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
        }

        function populateAttendeeCheckboxes(type) {
            const containerId = type === 'expense' ? 'expense-split-attendees' : 'activity-attendees';
            const container = document.getElementById(containerId);

            container.innerHTML = tripData.attendees.map(a => `
                <label class="checkbox-item" style="border: 2px solid ${a.color};">
                    <input type="checkbox" value="${a.id}" checked>
                    <span class="attendee-dot" style="background: ${a.color};"></span>
                    ${a.name}
                </label>
            `).join('');
        }

        // ============ EXPENSES ============
        function handleReceiptUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Compress image
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const maxSize = 800;
                        let width = img.width;
                        let height = img.height;

                        if (width > height && width > maxSize) {
                            height *= maxSize / width;
                            width = maxSize;
                        } else if (height > maxSize) {
                            width *= maxSize / height;
                            height = maxSize;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        currentReceiptData = canvas.toDataURL('image/jpeg', 0.7);
                        document.getElementById('receipt-preview').innerHTML = `
                            <img src="${currentReceiptData}" style="max-width: 100%; max-height: 150px; border-radius: 8px;">
                        `;
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function saveExpense() {
            const desc = document.getElementById('expense-desc').value.trim();
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const payerId = document.getElementById('expense-payer').value;
            const category = document.getElementById('expense-category').value;
            const date = document.getElementById('expense-date').value;

            if (!desc || !amount || !payerId) {
                showToast('Please fill in all required fields');
                return;
            }

            const splitAttendees = Array.from(document.querySelectorAll('#expense-split-attendees input:checked'))
                .map(cb => parseInt(cb.value));

            if (splitAttendees.length === 0) {
                showToast('Select at least one person to split with');
                return;
            }

            tripData.expenses.push({
                id: Date.now(),
                description: desc,
                amount: amount,
                payerId: parseInt(payerId),
                category: category,
                date: date,
                splitBetween: splitAttendees,
                receipt: currentReceiptData
            });

            saveData();
            renderAll();
            closeModal('expense');
            showToast('Expense added!');
        }

        function deleteExpense(id) {
            if (confirm('Delete this expense?')) {
                tripData.expenses = tripData.expenses.filter(e => e.id !== id);
                saveData();
                renderAll();
            }
        }

        function renderExpenses() {
            const container = document.getElementById('expense-list');

            if (tripData.expenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üíµ</div>
                        <p>No expenses yet.<br>Add your first expense!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = tripData.expenses.map(expense => {
                const payer = tripData.attendees.find(a => a.id === expense.payerId);
                const categoryLabels = {
                    food: 'Food', entertainment: 'Entertainment', transport: 'Transport',
                    accommodation: 'Hotel', nightlife: 'Nightlife', casino: 'Casino', other: 'Other'
                };

                return `
                    <div class="expense-item">
                        <div class="expense-info">
                            <div class="expense-desc">
                                ${expense.receipt ? 'üßæ ' : ''}${expense.description}
                            </div>
                            <div class="expense-meta">
                                <span class="category-pill cat-${expense.category}">${categoryLabels[expense.category]}</span>
                                Paid by ${payer ? payer.name : 'Unknown'} ‚Ä¢ ${formatDate(expense.date)}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="expense-amount">$${expense.amount.toFixed(2)}</div>
                            ${expense.receipt ? `<img src="${expense.receipt}" class="receipt-thumb" onclick="viewReceipt('${expense.receipt}')">` : ''}
                            <button class="btn-delete" onclick="deleteExpense(${expense.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Receipt gallery
            const gallery = document.getElementById('receipt-gallery');
            const receipts = tripData.expenses.filter(e => e.receipt);

            if (receipts.length === 0) {
                gallery.innerHTML = '<div class="empty-state" style="width: 100%;"><p>No receipts uploaded yet</p></div>';
            } else {
                gallery.innerHTML = receipts.map(e => `
                    <img src="${e.receipt}" class="receipt-thumb" onclick="viewReceipt('${e.receipt}')" title="${e.description}">
                `).join('');
            }
        }

        function viewReceipt(src) {
            document.getElementById('image-modal-img').src = src;
            document.getElementById('image-modal').classList.add('active');
        }

        function closeImageModal() {
            document.getElementById('image-modal').classList.remove('active');
        }

        function getTotalPaidBy(attendeeId) {
            return tripData.expenses
                .filter(e => e.payerId === attendeeId)
                .reduce((sum, e) => sum + e.amount, 0);
        }

        function calculateBalances() {
            const balances = {};
            tripData.attendees.forEach(a => balances[a.id] = 0);

            // Calculate balances from expenses
            tripData.expenses.forEach(expense => {
                const splitAmount = expense.amount / expense.splitBetween.length;

                // Payer paid the full amount
                balances[expense.payerId] += expense.amount;

                // Everyone who split owes their share
                expense.splitBetween.forEach(attendeeId => {
                    balances[attendeeId] -= splitAmount;
                });
            });

            // Apply reimbursements
            if (tripData.reimbursements) {
                tripData.reimbursements.forEach(r => {
                    // Person who paid (fromId) reduces their debt / increases their credit
                    if (balances[r.fromId] !== undefined) {
                        balances[r.fromId] += r.amount;
                    }
                    // Person who received (toId) reduces their credit / increases their debt
                    if (balances[r.toId] !== undefined) {
                        balances[r.toId] -= r.amount;
                    }
                });
            }

            return balances;
        }

        function calculateSettlements() {
            const balances = calculateBalances();
            const settlements = [];

            const debtors = [];
            const creditors = [];

            Object.entries(balances).forEach(([id, balance]) => {
                if (balance < -0.01) {
                    debtors.push({ id: parseInt(id), amount: Math.abs(balance) });
                } else if (balance > 0.01) {
                    creditors.push({ id: parseInt(id), amount: balance });
                }
            });

            // Simple settlement algorithm
            debtors.sort((a, b) => b.amount - a.amount);
            creditors.sort((a, b) => b.amount - a.amount);

            let i = 0, j = 0;
            while (i < debtors.length && j < creditors.length) {
                const amount = Math.min(debtors[i].amount, creditors[j].amount);
                if (amount > 0.01) {
                    settlements.push({
                        from: debtors[i].id,
                        to: creditors[j].id,
                        amount: amount
                    });
                }

                debtors[i].amount -= amount;
                creditors[j].amount -= amount;

                if (debtors[i].amount < 0.01) i++;
                if (creditors[j].amount < 0.01) j++;
            }

            return settlements;
        }

        function renderSettlements() {
            const container = document.getElementById('settlements');
            const settlements = calculateSettlements();

            if (settlements.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>Everyone is squared up! üéâ</p></div>';
                return;
            }

            container.innerHTML = settlements.map(s => {
                const from = tripData.attendees.find(a => a.id === s.from);
                const to = tripData.attendees.find(a => a.id === s.to);

                return `
                    <div class="settlement-item">
                        <span class="attendee-badge" style="background: ${from?.color || '#666'}20; border: 1px solid ${from?.color || '#666'}">
                            <span class="attendee-dot" style="background: ${from?.color || '#666'}"></span>
                            ${from?.name || 'Unknown'}
                        </span>
                        <span class="settlement-arrow">‚Üí</span>
                        <span class="attendee-badge" style="background: ${to?.color || '#666'}20; border: 1px solid ${to?.color || '#666'}">
                            <span class="attendee-dot" style="background: ${to?.color || '#666'}"></span>
                            ${to?.name || 'Unknown'}
                        </span>
                        <span style="margin-left: auto; font-family: 'Oswald', sans-serif; color: var(--gold-primary);">$${s.amount.toFixed(2)}</span>
                    </div>
                `;
            }).join('');
        }

        function renderExpenseSummary() {
            const container = document.getElementById('expense-summary');
            const total = tripData.expenses.reduce((sum, e) => sum + e.amount, 0);
            const perPerson = tripData.attendees.length > 0 ? total / tripData.attendees.length : 0;

            const byCategory = {};
            tripData.expenses.forEach(e => {
                byCategory[e.category] = (byCategory[e.category] || 0) + e.amount;
            });

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">$${total.toFixed(2)}</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">$${perPerson.toFixed(2)}</div>
                        <div class="stat-label">Per Person</div>
                    </div>
                </div>
            `;
        }

        // ============ REIMBURSEMENTS ============
        function populateReimbursementDropdowns() {
            const fromSelect = document.getElementById('reimburse-from');
            const toSelect = document.getElementById('reimburse-to');

            const options = '<option value="">Select person...</option>' +
                tripData.attendees.map(a => `<option value="${a.id}">${a.name}</option>`).join('');

            fromSelect.innerHTML = options;
            toSelect.innerHTML = options;
        }

        function saveReimbursement() {
            const fromId = document.getElementById('reimburse-from').value;
            const toId = document.getElementById('reimburse-to').value;
            const amount = parseFloat(document.getElementById('reimburse-amount').value);
            const date = document.getElementById('reimburse-date').value;
            const note = document.getElementById('reimburse-note').value.trim();

            if (!fromId || !toId) {
                showToast('Please select both people');
                return;
            }

            if (fromId === toId) {
                showToast('Cannot reimburse yourself');
                return;
            }

            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount');
                return;
            }

            if (!tripData.reimbursements) {
                tripData.reimbursements = [];
            }

            tripData.reimbursements.push({
                id: Date.now(),
                fromId: parseInt(fromId),
                toId: parseInt(toId),
                amount: amount,
                date: date,
                note: note
            });

            saveData();
            renderAll();
            closeModal('reimbursement');

            const fromName = tripData.attendees.find(a => a.id === parseInt(fromId))?.name;
            const toName = tripData.attendees.find(a => a.id === parseInt(toId))?.name;
            showToast(`Recorded $${amount.toFixed(2)} from ${fromName} to ${toName}`);
        }

        function deleteReimbursement(id) {
            if (confirm('Delete this reimbursement?')) {
                tripData.reimbursements = tripData.reimbursements.filter(r => r.id !== id);
                saveData();
                renderAll();
            }
        }

        function renderReimbursements() {
            const container = document.getElementById('reimbursement-list');

            if (!tripData.reimbursements || tripData.reimbursements.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>No reimbursements recorded yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = tripData.reimbursements.map(r => {
                const from = tripData.attendees.find(a => a.id === r.fromId);
                const to = tripData.attendees.find(a => a.id === r.toId);

                return `
                    <div class="settlement-item" style="background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3);">
                        <span class="attendee-badge" style="background: ${from?.color || '#666'}20; border: 1px solid ${from?.color || '#666'}">
                            <span class="attendee-dot" style="background: ${from?.color || '#666'}"></span>
                            ${from?.name || 'Unknown'}
                        </span>
                        <span style="color: #4CAF50;">paid</span>
                        <span class="attendee-badge" style="background: ${to?.color || '#666'}20; border: 1px solid ${to?.color || '#666'}">
                            <span class="attendee-dot" style="background: ${to?.color || '#666'}"></span>
                            ${to?.name || 'Unknown'}
                        </span>
                        <span style="margin-left: auto; font-family: 'Oswald', sans-serif; color: #4CAF50;">$${r.amount.toFixed(2)}</span>
                        ${r.note ? `<span style="font-size: 0.8rem; opacity: 0.7; margin-left: 5px;">(${r.note})</span>` : ''}
                        <button class="btn-delete" onclick="deleteReimbursement(${r.id})">üóëÔ∏è</button>
                    </div>
                `;
            }).join('');
        }

        // ============ ACTIVITIES ============
        function saveActivity() {
            const name = document.getElementById('activity-name').value.trim();
            const date = document.getElementById('activity-date').value;
            const time = document.getElementById('activity-time').value;
            const location = document.getElementById('activity-location').value.trim();
            const category = document.getElementById('activity-category').value;
            const cost = parseFloat(document.getElementById('activity-cost').value) || 0;
            const status = document.getElementById('activity-status').value;
            const notes = document.getElementById('activity-notes').value.trim();

            if (!name) {
                showToast('Please enter an activity name');
                return;
            }

            const attendees = Array.from(document.querySelectorAll('#activity-attendees input:checked'))
                .map(cb => parseInt(cb.value));

            // Get coordinates for Las Vegas locations (simplified - would use geocoding API in production)
            const coords = getVegasCoordinates(location);

            tripData.activities.push({
                id: Date.now(),
                name: name,
                date: date,
                time: time,
                location: location,
                category: category,
                cost: cost,
                status: status,
                notes: notes,
                attendees: attendees,
                lat: coords.lat,
                lng: coords.lng
            });

            saveData();
            renderAll();
            closeModal('activity');
            showToast('Activity added!');
        }

        function deleteActivity(id) {
            if (confirm('Delete this activity?')) {
                tripData.activities = tripData.activities.filter(a => a.id !== id);
                saveData();
                renderAll();
            }
        }

        function getVegasCoordinates(location) {
            // Simplified coordinate lookup for common Vegas locations
            const locations = {
                'bellagio': { lat: 36.1129, lng: -115.1765 },
                'mgm': { lat: 36.1024, lng: -115.1695 },
                'caesars': { lat: 36.1162, lng: -115.1745 },
                'venetian': { lat: 36.1211, lng: -115.1697 },
                'wynn': { lat: 36.1267, lng: -115.1622 },
                'luxor': { lat: 36.0955, lng: -115.1761 },
                'mandalay': { lat: 36.0909, lng: -115.1761 },
                'aria': { lat: 36.1072, lng: -115.1778 },
                'cosmopolitan': { lat: 36.1097, lng: -115.1743 },
                'fremont': { lat: 36.1699, lng: -115.1398 }
            };

            const lowerLoc = location.toLowerCase();
            for (const [key, coords] of Object.entries(locations)) {
                if (lowerLoc.includes(key)) {
                    return coords;
                }
            }

            // Default to center of Strip
            return { lat: 36.1147 + (Math.random() - 0.5) * 0.02, lng: -115.1728 + (Math.random() - 0.5) * 0.02 };
        }

        function renderActivities() {
            const container = document.getElementById('activity-list');
            const filtered = tripData.activities
                .filter(a => a.date === selectedDate)
                .sort((a, b) => (a.time || '').localeCompare(b.time || ''));

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üóìÔ∏è</div>
                        <p>No activities for this day.<br>Time to plan some fun!</p>
                    </div>
                `;
                return;
            }

            const categoryIcons = {
                food: 'üçî', casino: 'üé∞', shows: 'üé≠', nightlife: 'üç∏',
                stripclub: 'üíÉ', attraction: 'üé¢', other: 'üìç'
            };

            container.innerHTML = filtered.map(activity => {
                const attendeeNames = activity.attendees
                    .map(id => tripData.attendees.find(a => a.id === id)?.name)
                    .filter(Boolean)
                    .join(', ');

                return `
                    <div class="activity-item">
                        <span class="activity-status ${activity.status === 'confirmed' ? 'status-confirmed' : 'status-tentative'}">
                            ${activity.status === 'confirmed' ? '‚úì Confirmed' : '? Tentative'}
                        </span>
                        <div class="activity-time">${activity.time ? formatTime(activity.time) : 'TBD'}</div>
                        <div class="activity-name">${categoryIcons[activity.category] || 'üìç'} ${activity.name}</div>
                        ${activity.location ? `<div class="activity-location" onclick="openInMaps('${activity.location}')">üìç ${activity.location}</div>` : ''}
                        ${activity.cost > 0 ? `<div style="font-size: 0.85rem; color: var(--gold-primary);">üí∞ ~$${activity.cost.toFixed(2)}</div>` : ''}
                        ${attendeeNames ? `<div style="font-size: 0.8rem; opacity: 0.7; margin-top: 5px;">üë• ${attendeeNames}</div>` : ''}
                        ${activity.notes ? `<div style="font-size: 0.8rem; opacity: 0.7; margin-top: 5px;">üìù ${activity.notes}</div>` : ''}
                        <button class="btn-delete" style="position: absolute; bottom: 10px; right: 10px;" onclick="deleteActivity(${activity.id})">üóëÔ∏è</button>
                    </div>
                `;
            }).join('');
        }

        function filterActivities(category) {
            // Could implement filtering here
            renderActivities();
        }

        function addEventToItinerary(name, location, category) {
            document.getElementById('activity-name').value = name;
            document.getElementById('activity-location').value = location;
            document.getElementById('activity-category').value = category;
            openModal('activity');
            populateAttendeeCheckboxes('activity');
        }

        function openInMaps(location) {
            const query = encodeURIComponent(location + ' Las Vegas');
            // Check if iOS
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            if (isIOS) {
                window.open(`maps://maps.google.com/maps?q=${query}`, '_blank');
            } else {
                window.open(`https://www.google.com/maps/search/${query}`, '_blank');
            }
        }

        // ============ MAP ============
        function initMap() {
            if (map) {
                map.remove();
            }

            map = L.map('main-map').setView([36.1147, -115.1728], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            renderMapMarkers();
        }

        function renderMapMarkers() {
            if (!map) return;

            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            const categoryColors = {
                food: '#FF9800',
                casino: '#0d5c2e',
                shows: '#D32F2F',
                nightlife: '#E91E63',
                stripclub: '#9C27B0',
                attraction: '#00CED1',
                other: '#607D8B'
            };

            tripData.activities.forEach(activity => {
                if (activity.lat && activity.lng) {
                    const color = categoryColors[activity.category] || '#FFD700';
                    const marker = L.circleMarker([activity.lat, activity.lng], {
                        radius: 10,
                        fillColor: color,
                        color: '#fff',
                        weight: 2,
                        fillOpacity: 0.8
                    }).addTo(map);

                    marker.bindPopup(`
                        <strong>${activity.name}</strong><br>
                        ${activity.location || ''}<br>
                        ${activity.date} ${activity.time ? formatTime(activity.time) : ''}
                    `);

                    markers.push(marker);
                }
            });

            // Render locations list
            const listContainer = document.getElementById('map-locations-list');
            if (tripData.activities.length === 0) {
                listContainer.innerHTML = '<div class="empty-state"><p>Add activities to see them on the map</p></div>';
            } else {
                listContainer.innerHTML = tripData.activities.map(a => `
                    <div class="expense-item" onclick="focusMapLocation(${a.lat}, ${a.lng})" style="cursor: pointer;">
                        <div>
                            <div style="font-weight: 600;">${a.name}</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">${a.location || 'No location'}</div>
                        </div>
                        <span class="category-pill cat-${a.category}">${a.category}</span>
                    </div>
                `).join('');
            }
        }

        function focusMapLocation(lat, lng) {
            if (map && lat && lng) {
                map.setView([lat, lng], 16);
            }
        }

        function filterMapPins(category) {
            renderMapMarkers();
            // Could implement filtering here
        }

        // ============ DASHBOARD ============
        function renderDashboard() {
            // Total spent
            const total = tripData.expenses.reduce((sum, e) => sum + e.amount, 0);
            document.getElementById('total-spent').textContent = `$${total.toFixed(2)}`;

            // Stats
            document.getElementById('stat-expenses').textContent = tripData.expenses.length;
            document.getElementById('stat-attendees').textContent = tripData.attendees.length;
            document.getElementById('stat-activities').textContent = tripData.activities.length;

            const avgPerPerson = tripData.attendees.length > 0 ? total / tripData.attendees.length : 0;
            document.getElementById('stat-average').textContent = `$${avgPerPerson.toFixed(0)}`;

            // Upcoming activities
            const upcomingContainer = document.getElementById('upcoming-activities');
            const upcoming = tripData.activities
                .sort((a, b) => {
                    if (a.date !== b.date) return a.date.localeCompare(b.date);
                    return (a.time || '').localeCompare(b.time || '');
                })
                .slice(0, 3);

            if (upcoming.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üé≠</div>
                        <p>No activities planned yet.</p>
                    </div>
                `;
            } else {
                upcomingContainer.innerHTML = upcoming.map(a => `
                    <div class="activity-item" style="margin-bottom: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <div style="font-weight: 600;">${a.name}</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">${formatDate(a.date)} ${a.time ? '‚Ä¢ ' + formatTime(a.time) : ''}</div>
                            </div>
                            <span class="category-pill cat-${a.category}">${a.category}</span>
                        </div>
                    </div>
                `).join('');
            }

            // Balances
            const balancesContainer = document.getElementById('dashboard-balances');
            const settlements = calculateSettlements();

            if (settlements.length === 0) {
                balancesContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚ú®</div>
                        <p>All squared up!</p>
                    </div>
                `;
            } else {
                balancesContainer.innerHTML = settlements.slice(0, 3).map(s => {
                    const from = tripData.attendees.find(a => a.id === s.from);
                    const to = tripData.attendees.find(a => a.id === s.to);
                    return `
                        <div style="display: flex; align-items: center; gap: 8px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: ${from?.color || '#fff'}">${from?.name || '?'}</span>
                            <span>‚Üí</span>
                            <span style="color: ${to?.color || '#fff'}">${to?.name || '?'}</span>
                            <span style="margin-left: auto; color: var(--gold-primary);">$${s.amount.toFixed(2)}</span>
                        </div>
                    `;
                }).join('');
            }
        }

        // ============ UTILITIES ============
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        function formatTime(timeStr) {
            const [hours, minutes] = timeStr.split(':');
            const h = parseInt(hours);
            const ampm = h >= 12 ? 'PM' : 'AM';
            const h12 = h % 12 || 12;
            return `${h12}:${minutes} ${ampm}`;
        }

        function formatDateTime(dateTimeStr) {
            if (!dateTimeStr) return '';
            const date = new Date(dateTimeStr);
            const options = { weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' };
            return date.toLocaleDateString('en-US', options);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function renderAll() {
            renderDashboard();
            renderAttendees();
            renderExpenses();
            renderExpenseSummary();
            renderReimbursements();
            renderSettlements();
            renderActivities();
            if (map) {
                renderMapMarkers();
            }
        }

        // ============ INITIALIZE ============
        document.addEventListener('DOMContentLoaded', () => {
            loadData();

            // Close modals on overlay click
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });

            // Close image modal on click
            document.getElementById('image-modal').addEventListener('click', (e) => {
                if (e.target.id === 'image-modal') {
                    closeImageModal();
                }
            });
        });
    </script>
</body>
</html>
